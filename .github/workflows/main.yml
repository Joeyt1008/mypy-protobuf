name: CI

# Run on git push, PR, or manually from the Actions tab
on: [push, pull_request, workflow_dispatch]

jobs:

  
  armv64_job:
      name: Build and Test for arm64
      runs-on: ubuntu-20.04
      steps:
        - uses: actions/checkout@v2
        - name: Set up QEMU
          id: qemu
          uses: docker/setup-qemu-action@v1
        - name: Install and Run tests
          run: |
            docker run --rm -v ${{ github.workspace }}:/ws:rw --workdir=/ws \
              arm64v8/ubuntu:20.04 \
              bash -exc 'apt-get update && apt-get -y install python3 python3-pip curl git make build-essential libssl-dev zlib1g-dev wget && \
              git clone https://github.com/pyenv/pyenv.git ~/.pyenv && \
              exec "$SHELL" && \
              export PATH="/home/username/.pyenv/bin:$PATH" && \
              eval "$(pyenv init -)" && \
              eval "$(pyenv virtualenv-init -)" && \
              pyenv install --list && \
              pyenv install 3.8.11 && \
              pyenv versions && \
              pyenv global 3.8.11 && \
              python && \
              apt-get install python-pip && \
              pip --version && \
              ls && \
              pwd && \
              ./run_test.sh'
